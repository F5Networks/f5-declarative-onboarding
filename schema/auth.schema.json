{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "$id": "https://raw.githubusercontent.com/F5Networks/f5-declarative-onboarding/master/schema/auth.schema.json",
    "title": "F5 Declarative Onboarding Authentication declaration",
    "description": "Authentication properties for onboarding a BIG-IP.",
    "if": { "properties": { "class": { "const": "Authentication" } } },
    "then": {
        "oneOf": [
            { "$ref": "#/definitions/remoteInfo" }
        ]
    },
    "definitions": {
        "remoteInfo": {
            "required": ["class", "enabledSourceType"],
            "type": "object",
            "properties": {
                "class": {
                    "description": "Indicates that this property contains authentication configuration.",
                    "type": "string",
                    "const": "Authentication"
                },
                "enabledSourceType": {
                    "description": "Type of remote authentication source to enable for the system.",
                    "type": "string",
                    "enum": ["radius", "local", "ldap", "activeDirectory"],
                    "default": "local"
                },
                "remoteUsersDefaults": {
                    "description": "The default values that the BIG-IP system applies to any user account that is not part of a remotely-stored user group.",
                    "type": "object",
                    "required": [ "partitionAccess", "terminalAccess", "role" ],
                    "properties": {
                        "role": {
                            "description": "Role for the remote users.",
                            "type": "string",
                            "enum": [
                                "acceleration-policy-editor",
                                "admin",
                                "application-editor",
                                "auditor",
                                "certificate-manager",
                                "firewall-manager",
                                "fraud-protection-manager",
                                "guest",
                                "irule-manager",
                                "manager",
                                "no-access",
                                "operator",
                                "resource-admin",
                                "user-manager",
                                "web-application-security-administrator",
                                "web-application-security-editor"
                            ],
                            "default": "no-access"
                        },
                        "partitionAccess": {
                            "description": "Default accessible partitions for remote users.",
                            "type": "string",
                            "enum": ["Common", "all"],
                            "default": "all"
                        },
                        "terminalAccess": {
                            "description": "Default terminal access for remote users.",
                            "type": "string",
                            "enum": ["tmsh", "disabled"],
                            "default": "disabled"
                        }
                    },
                    "additionalProperties": false
                },
                "fallback": {
                    "description": "Specifies that the system uses the Local authentication method if the remote authentication method is not available.",
                    "type": "boolean",
                    "default": false
                },
                "radius": {
                    "$ref": "#/definitions/radius"
                },
                "ldap": {
                    "$ref": "#/definitions/ldap"
                }
            },
            "allOf": [
                {
                    "if": {
                        "required": ["enabledSourceType"],
                        "properties": { "enabledSourceType": { "const": "radius"} }
                    },
                    "then": { "required": ["radius"] }
                },
                {
                    "if": {
                        "required": ["enabledSourceType"],
                        "properties": { "enabledSourceType": { "oneOf": [
                            { "const": "ldap" },
                            { "const": "activeDirectory" }
                        ] } }
                    },
                    "then": { "required": ["ldap"] }
                }
            ],
            "additionalProperties": false
        },
        "radius": {
            "description": "Remote RADIUS authentication info.",
            "type": "object",
            "required": ["servers"],
            "properties": {
                "serviceType": {
                    "description": "Type of service used for the RADIUS server.",
                    "type": "string",
                    "enum": [
                        "administrative",
                        "authenticate-only",
                        "call-check",
                        "callback-administrative",
                        "callback-framed",
                        "callback-login",
                        "callback-nas-prompt",
                        "default",
                        "framed",
                        "login",
                        "nas-prompt",
                        "outbound"
                    ],
                    "default": "default"
                },
                "servers": {
                    "description": "RADIUS servers settings",
                    "required": ["primary"],
                    "properties": {
                        "primary": {
                            "description": "Server connection settings for the primary RADIUS server",
                            "allOf": [ {"$ref": "#/definitions/radiusServer"} ]
                        },
                        "secondary": {
                            "description": "Server connection settings for the secondary RADIUS server (optional)",
                            "allOf": [ {"$ref": "#/definitions/radiusServer"} ]
                        }
                    },
                    "additionalProperties": false
                }
            }
        },
        "radiusServer": {
            "description": "RADIUS server connection settings.",
            "type": "object",
            "required": [ "server", "secret" ],
            "properties": {
                "server": {
                    "type": "string",
                    "description": "The RADIUS server IP address or hostname.",
                    "anyOf": [
                        { "format": "ipv4" },
                        { "format": "ipv6" },
                        { "format": "hostname" }
                    ]
                },
                "port": {
                    "type": "integer",
                    "description": "Port to use when connecting to the RADIUS server.",
                    "default": 1812
                },
                "secret": {
                    "description": "Password to use when connection to the RADIUS server.",
                    "type": "string"
                }
            }
        },
        "ldap": {
            "description": "Remote LDAP authentication info",
            "type": "object",
            "required": ["servers"],
            "properties": {
                "bindDn": {
                    "description": "Distinguished name of the server account. If server is a Microsoft Windows Active Directory server, the name must be an email address",
                    "type": "string"
                },
                "bindPassword": {
                    "description": "Password for the server account",
                    "type": "string"
                },
                "bindTimeout": {
                    "description": "Timeout limit in seconds to bind to remote authentication server",
                    "type": "integer",
                    "minimum": 0,
                    "maximum": 4294967295,
                    "default": 30
                },
                "checkBindPassword": {
                    "description": "Confirms the password for the server account",
                    "type": "boolean",
                    "default": false
                },
                "checkRemoteRole": {
                    "description": "Verifies a user's group membership based on the remote-role definition, formatted as *member*of=\"group-dn\"",
                    "type": "boolean",
                    "default": false
                },
                "filter": {
                    "description": "Filter used for authorizing client traffic",
                    "type": "string"
                },
                "groupDn": {
                    "description": "Group distinguished name for authorizing client traffic",
                    "type": "string"
                },
                "groupMemberAttribute": {
                    "description": "Group member attribute for authorizing client traffic",
                    "type": "string"
                },
                "idleTimeout": {
                    "description": "Connection timeout limit in seconds",
                    "type": "integer",
                    "minimum": 0,
                    "maximum": 4294967295,
                    "default": 3600
                },
                "ignoreAuthInfoUnavailable": {
                    "description": "Ignores authentication information if not available",
                    "type": "boolean",
                    "default": false
                },
                "ignoreUnknownUser": {
                    "description": "Ignores a user that is unknown",
                    "type": "boolean",
                    "default": false
                },
                "loginAttribute": {
                    "description": "Logon attribute. If server is a Microsoft Windows Active Directory server, the value must be the account name \"samaccountname\"",
                    "type": "string"
                },
                "port": {
                    "description": "Port number for the LDAP service",
                    "type": "integer",
                    "minimum": 0,
                    "maximum": 65535,
                    "default": 389
                },
                "searchScope": {
                    "description": "Level of remote server's directory to search for user authentication, either base object, one level, or subtree",
                    "type": "string",
                    "enum": ["base", "one", "sub"],
                    "default": "sub"
                },
                "searchBaseDn": {
                    "description": "Search base distinguished name",
                    "type": "string"
                },
                "searchTimeout": {
                    "description": "Search timeout limit in seconds",
                    "type": "integer",
                    "minimum": 0,
                    "maximum": 4294967295,
                    "default": 30
                },
                "servers": {
                    "description": "IP addresses or hostnames of the remote authentication servers.",
                    "type": "array",
                    "minItems": 1,
                    "items": {
                        "type": "string"
                    }
                },
                "userTemplate": {
                    "description": "Specifies a user template for the LDAP application to use for authentication.",
                    "type": "string"
                },
                "version": {
                    "description": "Specifies the version number of the LDAP application.",
                    "type": "integer",
                    "minimum": 2,
                    "maximum": 3,
                    "default": 3
                }
            },
            "additionalProperties": false
        }
    }
}
