{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "$id": "https://raw.githubusercontent.com/F5Networks/f5-declarative-onboarding/master/schema/analytics.schema.json",
    "title": "F5 Declarative Onboarding Global Analytics declaration",
    "description": "Global analytics properties for onboarding a BIG-IP.",
    "if": { "properties": { "class": { "const": "Analytics" } } },
    "then": {
        "required": ["class"],
        "properties": {
            "class": {
                "description": "Indicates that this property contains global analytics configuration",
                "type": "string",
                "const": "Analytics"
            },
            "debugEnabled": {
                "description": "Enable debug mode.  If debug mode is disabled, internal statistics are collected only if debugInterval is set to the default value (300 seconds)",
                "type": "boolean",
                "default": false
            },
            "interval": {
                "description": "Analytics data collection interval in seconds.  If this interval is different from the default value (300 seconds), internal statistics are not collected unless debugEnabled is set to true.  Minimum interval is 20 seconds, maximum interval is 300 seconds.",
                "type": "integer",
                "minimum": 20,
                "maximum": 300,
                "default": 300
            },
            "elasticComputeManagerAddress": {
                "description": "Elastic Compute Manager IP address.  BIG-IP deprecated in 13.1.",
                "type": "string",
                "anyOf": [
                    { "format": "ipv4" },
                    { "format": "ipv6" },
                    { "format": "json-pointer" }
                ]
            },
            "elasticComputeManagerPort": {
                "description": "Elastic Compute Manager port.  BIG-IP deprecated in 13.1.",
                "type": "number",
                "minimum": 0,
                "maximum": 65535,
                "default": 0
            },
            "offboxProtocol": {
                "description": "Protocol for communication with offbox analytics application",
                "type": "string",
                "enum": ["ecm-tm", "https", "none", "tcp"]
            },
            "offboxTcpAddresses": {
                "description": "Server IP addresses used only if the 'tcp' protocol is chosen",
                "type": "array",
                "items": {
                    "type": "string",
                    "anyOf": [
                        { "format": "ipv4" },
                        { "format": "ipv6"},
                        { "format": "json-pointer" }
                    ]
                }
            },
            "offboxTcpPort": {
                "description": "Server TCP port for the server IP addresses used only if the 'tcp' protocol is chosen",
                "type": "number",
                "minimum": 0,
                "maximum": 65535,
                "default": 0
            },
            "elasticComputeManagerEnabled": {
                "description": "Enables all communication with the Elastic Compute Manager on the global level.  BIG-IP deprecated in 13.1.",
                "type": "boolean",
                "default": false
            },
            "offboxEnabled": {
                "description": "Enables all communication with the offbox application on the global level",
                "type": "boolean",
                "default": false
            }
        },
        "additionalProperties": false,
        "allOf": [
            {
                "if": { "properties": { "elasticComputeManagerEnabled": { "const": true } } },
                "then": {
                    "required": ["elasticComputeManagerAddress", "elasticComputeManagerPort"]
                }
            },
            {
                "if": { "properties": { "offboxEnabled": { "const": true } } },
                "then": {
                    "required": ["offboxProtocol"],
                    "dependencies": {
                        "not": {
                            "properties": {
                                "offboxProtocol": {
                                    "const": "none"
                                }
                            }
                        }
                    }
                }
            },
            {
                "if": { "properties": { "offboxProtocol": { "const": "tcp" } } },
                "then": {
                    "required": ["offboxTcpAddresses", "offboxTcpPort"]
                }
            }
        ]
    }
}